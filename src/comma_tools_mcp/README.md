# comma-tools MCP Server

Model Context Protocol (MCP) server for the comma-tools CTS-Lite API. This server exposes all CTS-Lite analysis tools to AI assistants like Claude, enabling natural language interaction with log analysis, run management, and artifact access.

## Features

### Tools
- **check_health()** - Check if CTS-Lite API server is healthy
- **get_version()** - Get API version and compatibility info
- **list_capabilities()** - List available analysis tools
- **run_analysis(tool_id, file_path, parameters)** - Run analysis on log files
- **get_run_status(run_id)** - Check status of running analysis
- **list_runs(status, limit)** - List recent analysis runs
- **list_artifacts(run_id)** - List artifacts generated by a run
- **get_artifact_content(artifact_id)** - Get text content of an artifact
- **download_artifact(artifact_id, output_path)** - Download artifact to file
- **upload_file(file_path)** - Upload file for analysis

### Resources
- **cts://config** - Get server configuration and status
- **cts://capabilities** - Get summary of available analysis tools

## Installation

```bash
# Install comma-tools with MCP support
pip install -e ".[mcp]"
```

## Usage

### With Claude Desktop

Add to your Claude Desktop configuration (`~/Library/Application Support/Claude/claude_desktop_config.json` on macOS):

```json
{
  "mcpServers": {
    "comma-tools": {
      "command": "cts-mcp",
      "env": {
        "CTS_LITE_URL": "http://127.0.0.1:8080"
      }
    }
  }
}
```

Then restart Claude Desktop.

### Testing the Server

```bash
# Make sure CTS-Lite is running
cts-lite &

# Test the MCP server tools directly
python -c "
from comma_tools_mcp.server import check_health, list_capabilities
import json
print(json.dumps(check_health(), indent=2))
print(json.dumps(list_capabilities(), indent=2))
"
```

### With MCP Inspector (Development)

```bash
# Install MCP inspector
pip install mcp-inspector

# Start the server in development mode
mcp dev src/comma_tools_mcp/server.py
```

## Environment Variables

- `CTS_LITE_URL` - URL of the CTS-Lite API server (default: `http://127.0.0.1:8080`)

## Example Conversations with Claude

Once configured, you can ask Claude things like:

- "Check if the CTS-Lite server is healthy"
- "What analysis tools are available?"
- "Analyze this log file: /path/to/log.zst using rlog-to-csv"
- "Show me the status of run abc123"
- "List my recent analysis runs"
- "Download the CSV artifact from that last run"

## Architecture

```
AI Assistant (Claude, etc)
    ↓ MCP Protocol
comma-tools MCP Server
    ↓ HTTP/REST
CTS-Lite API Server
    ↓
Analysis Tools (rlog-to-csv, can-bitwatch, etc)
```

## Development

### Adding New Tools

To add a new tool to the MCP server:

1. Add a function decorated with `@mcp.tool()` in `server.py`
2. Use type hints for parameters and return values
3. Add a comprehensive docstring
4. Make HTTP requests to the CTS-Lite API using `make_request()`

Example:
```python
@mcp.tool()
def my_new_tool(param: str) -> Dict[str, Any]:
    \"\"\"
    Description of what this tool does.

    Args:
        param: Description of parameter

    Returns:
        Description of return value
    \"\"\"
    return make_request("GET", f"/v1/my-endpoint/{param}")
```

### Testing

```python
# Test individual tools
from comma_tools_mcp.server import check_health
result = check_health()
print(result)
```

## Troubleshooting

### Server Not Starting

- Make sure CTS-Lite is running: `cts-lite`
- Check the URL is correct: `curl http://127.0.0.1:8080/v1/health`
- Verify MCP dependencies are installed: `pip install -e ".[mcp]"`

### Claude Desktop Not Finding Server

- Check the configuration file path
- Ensure `cts-mcp` command is in your PATH
- Restart Claude Desktop after configuration changes
- Check Claude Desktop logs for error messages

### Connection Refused

- CTS-Lite server must be running before starting the MCP server
- Check firewall settings if using a non-localhost URL
- Verify the port number in `CTS_LITE_URL`

## Future Enhancements

- [ ] Streaming support for long-running analyses
- [ ] Webhook notifications for run completion
- [ ] Batch analysis operations
- [ ] Integration with ChatGPT MCP for multi-AI workflows