Metadata-Version: 2.4
Name: comma-tools
Version: 0.1.0
Summary: Debugging and analysis tools for openpilot autonomous driving system
Author-email: Dan Mann <dan.b.mann@gmail.com>
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: matplotlib
Requires-Dist: numpy
Requires-Dist: pycapnp
Requires-Dist: tqdm
Requires-Dist: zstandard
Requires-Dist: pyzmq
Requires-Dist: smbus2
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov; extra == "dev"
Requires-Dist: black; extra == "dev"
Requires-Dist: flake8; extra == "dev"
Requires-Dist: mypy; extra == "dev"

# Comma Tools
[![Test Suite](https://github.com/anteew/comma-tools/actions/workflows/test.yml/badge.svg)](https://github.com/anteew/comma-tools/actions/workflows/test.yml)

Debugging and analysis tools for the openpilot autonomous driving system.

## Overview

This repository contains a collection of debugging and analysis tools for the openpilot autonomous driving system. The tools are primarily focused on Controller Area Network (CAN) bus analysis, safety system monitoring, and vehicle behavior debugging.

## Installation

```bash
# Clone the repository
git clone https://github.com/anteew/comma-tools.git
cd comma-tools

# Install in development mode
pip install -e .

# Or install with development dependencies
pip install -e ".[dev]"
```

## Tools

### Analyzers
- **Cruise Control Analyzer** (`cruise-control-analyzer`): Deep analysis of recorded driving logs (`rlog.zst` files) with focus on Subaru vehicle cruise control systems

### Monitors
- **Hybrid RX Trace** (`hybrid_rx_trace.py`): Real-time monitoring of Panda safety states
- **Panda State** (`panda-state.py`): General Panda device status reporting  
- **CAN Bus Check** (`can_bus_check.py`): General CAN message frequency analysis
- **CAN Hybrid RX Check** (`can_hybrid_rx_check.py`): Subaru hybrid-specific signal monitoring

### Utilities
- **Simple Panda** (`simple-panda.py`): Basic Panda health check utility

### Scripts
- Various shell script wrappers for common operations

## Usage

### Cruise Control Analyzer

```bash
# Analyze a log file (first run - installs dependencies)
cruise-control-analyzer /path/to/logfile.zst --install-missing-deps

# Subsequent runs
cruise-control-analyzer /path/to/logfile.zst

# With custom speed range
cruise-control-analyzer /path/to/logfile.zst --speed-min 50 --speed-max 60
```

### Real-time Monitoring

```bash
# Monitor Panda safety states
python -m comma_tools.monitors.hybrid_rx_trace

# Check CAN bus activity
python -m comma_tools.monitors.can_bus_check
```

## Development

```bash
# Install development dependencies
pip install -e ".[dev]"

# Run tests
pytest

# Format code
black src/ tests/

# Type checking
mypy src/
```

## Project Structure

```
comma-tools/
├── src/comma_tools/           # Main package
│   ├── analyzers/            # Log analysis tools
│   ├── monitors/             # Real-time monitoring
│   └── utils/                # Shared utilities
├── tests/                    # Test suite
├── scripts/                  # Shell script wrappers
└── docs/                     # Documentation
```

## Requirements

- Python 3.12 (project is tested on 3.9–3.12 in CI)
- openpilot installation (for some tools)
- Panda device (for real-time monitoring tools)
## Integration tests with a real rlog.zst

By default, tests run without any large external files. To exercise the analyzer with a real log:

Option A: environment variable
```bash
LOG_FILE=/absolute/path/to/your.rlog.zst pytest tests/integration -v -m integration
```

Option B: pytest option
```bash
pytest tests/integration -v -m integration --log-file=/absolute/path/to/your.rlog.zst
```

Notes:
- If no log is provided, these tests are skipped automatically.
- To also test dependency bootstrap, keep `openpilot/` checked out next to `comma-tools/` or pass `--repo-root` to the CLI.

## License

MIT License - see LICENSE file for details.
